<h2 class="text-center my-4 fw-bold">üè° Add New Property</h2>

<!-- Message Box -->
<div *ngIf="msg" 
     [ngClass]="{'alert alert-success': msg.includes('uploaded') || msg.includes('created'), 
                 'alert alert-danger': !msg.includes('uploaded') && !msg.includes('created')}" 
     role="alert">
  {{ msg }}
</div>

<form (ngSubmit)="create()" class="p-4 shadow rounded bg-light">
  <div class="row g-3">
    <!-- Title -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="model.title" name="title" required />
      </mat-form-field>
    </div>

    <!-- City -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>City</mat-label>
        <input matInput [(ngModel)]="model.city" name="city" required />
      </mat-form-field>
    </div>

    <!-- Country -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Country</mat-label>
        <input matInput [(ngModel)]="model.country" name="country" required />
      </mat-form-field>
    </div>

    <!-- Property Type -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Property Type</mat-label>
        <mat-select [(ngModel)]="model.propertyType" name="ptype">
          <mat-option value="Apartment">Apartment</mat-option>
          <mat-option value="Villa">Villa</mat-option>
          <mat-option value="House">House</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Description -->
    <div class="col-12">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Description</mat-label>
        <textarea matInput rows="4" [(ngModel)]="model.description" name="desc"></textarea>
      </mat-form-field>
    </div>

    <!-- Price per night -->
    <div class="col-md-4">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Price per night</mat-label>
        <input type="number" min="1" matInput [(ngModel)]="model.pricePerNight" name="price" required />
      </mat-form-field>
    </div>

    <!-- Max Guests -->
    <div class="col-md-4">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Max Guests</mat-label>
        <input type="number" min="1" matInput [(ngModel)]="model.maxGuests" name="guests" required />
      </mat-form-field>
    </div>

    <!-- Bedrooms -->
    <div class="col-md-4">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Bedrooms</mat-label>
        <input type="number" min="0" matInput [(ngModel)]="model.bedrooms" name="beds" required />
      </mat-form-field>
    </div>

    <!-- Bathrooms -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Bathrooms</mat-label>
        <input type="number" min="1" matInput [(ngModel)]="model.bathrooms" name="bathrooms" required />
      </mat-form-field>
    </div>

    <!-- Amenities -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Amenities</mat-label>
        <mat-select [(ngModel)]="model.amenityIds" name="amenities" multiple>
          <mat-option *ngFor="let a of amenitiesList" [value]="a.id">{{ a.name }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-12">
      <label class="form-label fw-semibold">üì∏ Upload Images (max 5)</label>
      <input type="file" multiple (change)="fileChanged($event)" accept="image/*" class="form-control mb-3" />
      
      <!-- Preview thumbnails -->
      <div class="d-flex flex-wrap gap-3 mb-3" *ngIf="files.length">
        <div *ngFor="let f of files" class="border rounded p-1" style="width: 120px; height: 120px; overflow: hidden;">
          <img [src]="getFileUrl(f)" alt="Preview" class="img-fluid rounded" style="object-fit: cover; width: 100%; height: 100%;" />
        </div>
      </div>
    </div>

    <!-- Submit button -->
    <div class="col-12 text-center">
      <button mat-raised-button color="primary" type="submit" class="btn btn-primary px-5 py-2 mt-3">
        Add Property
      </button>
    </div>
  </div>
</form>

